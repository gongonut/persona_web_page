import{b as K,c as J,d as X,f as Z,g as ee,h as te,i as ne,j as ie}from"./chunk-P34YCOLR.js";import{D as b,G as d,H as D,J as l,K as a,L as v,M as S,N as y,O as u,Q as E,R as C,S as M,T as p,U as I,V as P,W as T,X as R,Y as O,_ as V,ba as Q,c as W,ca as j,ja as N,ka as $,l as f,la as G,m as h,n as k,o as B,oa as q,pa as U,r as L,t as z,ta as Y,v as F,w as c,y as A,z as H}from"./chunk-DS4NGIYP.js";var pe=["videoElement"],ge=["canvasElement"],ue=["imageElement"],fe=["controlsPanel"],he=["toggleButton"],re=()=>({"bg-gray-800 text-white":!0,"bg-white text-black shadow-lg":!1});function be(r,t){r&1&&(k(),l(0,"svg",17),v(1,"path",18),a())}function ve(r,t){r&1&&(k(),l(0,"svg",17),v(1,"path",19),a())}function xe(r,t){if(r&1){let e=S();l(0,"button",38),y("click",function(){f(e);let i=u(2);return h(i.captureSnapshot())}),p(1," Capturar Foto "),a()}}function _e(r,t){if(r&1&&(l(0,"option",39),p(1),a()),r&2){let e=t.$implicit;d("value",e.value),c(),I(e.name)}}function ye(r,t){if(r&1){let e=S();l(0,"div",20,2)(2,"button",21),k(),l(3,"svg",22),v(4,"path",23),a(),B(),l(5,"span"),p(6,"Extractor de Paletas"),a()(),l(7,"div",24)(8,"p",25),p(9,"Fuente de Imagen"),a(),l(10,"div",26)(11,"label",27),p(12," Subir Archivo "),a(),l(13,"input",28),y("change",function(i){f(e);let o=u();return h(o.onFileSelected(i))}),a(),l(14,"button",29),y("click",function(){f(e);let i=u();return h(i.toggleWebcam())}),p(15),a()(),b(16,xe,2,0,"button",30),a(),l(17,"div",24)(18,"p",25),p(19,"Configuraci\xF3n de An\xE1lisis"),a(),l(20,"div",31)(21,"label",32),p(22,"Modelo de Color"),a(),l(23,"select",33),O("ngModelChange",function(i){f(e);let o=u();return R(o.colorModel,i)||(o.colorModel=i),h(i)}),b(24,_e,2,2,"option",34),a()(),l(25,"div")(26,"label",35),p(27),a(),l(28,"input",36),O("ngModelChange",function(i){f(e);let o=u();return R(o.paletteSize,i)||(o.paletteSize=i),h(i)}),a()()(),l(29,"button",37),y("click",function(){f(e);let i=u();return h(i.analyzeImage())}),p(30," Analizar Imagen "),a()()}if(r&2){let e=u();d("ngClass",V(8,re)),c(15),P(" ",e.isWebcamOn?"Apagar C\xE1mara":"Usar C\xE1mara"," "),c(),d("ngIf",e.isWebcamOn),c(7),T("ngModel",e.colorModel),c(),d("ngForOf",e.colorModelsOptions),c(3),P("Nivel de Detalle (",e.paletteSize," colores)"),c(),T("ngModel",e.paletteSize),c(),d("disabled",!e.imageSrc)}}function we(r,t){r&1&&(l(0,"div",40)(1,"p",41),p(2,"Sube una imagen o activa la c\xE1mara"),a()())}function Ee(r,t){if(r&1&&v(0,"img",42,3),r&2){let e=u();d("src",e.imageSrc,z)}}function Ce(r,t){r&1&&v(0,"video",43,4)}function Me(r,t){if(r&1&&(l(0,"div",48),v(1,"div",49),l(2,"p",50),p(3),a(),l(4,"p",51),p(5),Q(6,"number"),a()()),r&2){let e=t.$implicit;c(),D("background-color",e.hex),c(2),I(e.displayCode),c(2),P("",j(6,4,e.percentage,"1.2-2"),"%")}}function ke(r,t){if(r&1&&(l(0,"div",44)(1,"h3",45),p(2,"Paleta de Colores Resultante"),a(),l(3,"div",46),b(4,Me,7,7,"div",47),a()()),r&2){let e=u();c(4),d("ngForOf",e.palette)}}function Se(r,t){r&1&&(l(0,"div",40)(1,"p",41),p(2,"Analizando imagen..."),a()())}var oe=class r{constructor(t){this.elementRef=t}controlsCollapsed=!1;isWebcamOn=!1;imageSrc=null;colorModelsOptions=[{name:"RGB",value:"rgb"},{name:"CMYK",value:"cmyk"},{name:"RYB",value:"ryb"}];colorModel="rgb";paletteSize=8;palette=[];isLoading=!1;videoElement;canvasElement;imageElement;controlsPanel;toggleButton;stream=null;onDocumentClick(t){if(this.controlsCollapsed)return;let e=t.target;this.toggleButton?.nativeElement.contains(e)||this.controlsPanel&&!this.controlsPanel.nativeElement.contains(e)&&(this.controlsCollapsed=!0)}onFileSelected(t){let e=t.target;if(e.files&&e.files[0]){let n=new FileReader;n.onload=i=>{this.imageSrc=i.target?.result,this.stopWebcam()},n.readAsDataURL(e.files[0])}}toggleWebcam(){this.isWebcamOn?this.stopWebcam():this.startWebcam()}startWebcam(){this.imageSrc=null,this.isWebcamOn=!0,navigator.mediaDevices.getUserMedia({video:!0}).then(t=>{this.stream=t,this.videoElement&&(this.videoElement.nativeElement.srcObject=t)}).catch(t=>{console.error("Error accessing webcam: ",t),this.isWebcamOn=!1})}stopWebcam(){this.stream&&this.stream.getTracks().forEach(t=>t.stop()),this.isWebcamOn=!1,this.stream=null}captureSnapshot(){if(this.videoElement&&this.canvasElement){let t=this.videoElement.nativeElement,e=this.canvasElement.nativeElement;e.width=t.videoWidth,e.height=t.videoHeight;let n=e.getContext("2d");n&&(n.drawImage(t,0,0,e.width,e.height),this.imageSrc=e.toDataURL("image/png"),this.stopWebcam())}}analyzeImage(){return W(this,null,function*(){!this.imageSrc||!this.imageElement&&!this.videoElement||(this.isLoading=!0,this.palette=[],setTimeout(()=>{try{let t=this.getPixels();if(!t){this.isLoading=!1;return}let e=this.quantize(t,this.paletteSize);this.generatePalette(e)}catch(t){console.error("Error analyzing image:",t)}this.isLoading=!1},100))})}getPixels(){if(!this.canvasElement||!this.imageElement?.nativeElement)return null;let t=this.canvasElement.nativeElement,e=t.getContext("2d"),n=this.imageElement.nativeElement;return!e||!n.src?null:(t.width=n.naturalWidth,t.height=n.naturalHeight,e.drawImage(n,0,0),e.getImageData(0,0,t.width,t.height).data)}quantize(t,e){let n=new Map;for(let s=0;s<t.length;s+=4){let m=Math.round(t[s]/32)*32,w=Math.round(t[s+1]/32)*32,x=Math.round(t[s+2]/32)*32;if(t[s+3]<128)continue;let g=`${m},${w},${x}`;n.set(g,(n.get(g)||0)+1)}let i=Array.from(n.entries()).sort((s,m)=>m[1]-s[1]),o=new Map;for(let s=0;s<Math.min(i.length,e);s++)o.set(i[s][0],i[s][1]);return o}generatePalette(t){let e=Array.from(t.values()).reduce((n,i)=>n+i,0);this.palette=Array.from(t.entries()).map(([n,i])=>{let[o,s,m]=n.split(",").map(Number),w=i/e*100,x=this.rgbToHex(o,s,m),_=x;if(this.colorModel==="cmyk"){let g=this.rgbToCmyk(o,s,m);_=`CMYK(${g.c}%, ${g.m}%, ${g.y}%, ${g.k}%)`}else if(this.colorModel==="ryb"){let g=this.rgbToRyb(o,s,m);_=`RYB(${g.r}, ${g.y}, ${g.b})`}else _=`RGB(${o}, ${s}, ${m})`;return{hex:x,displayCode:_,percentage:w}}).sort((n,i)=>i.percentage-n.percentage)}rgbToHex(t,e,n){return"#"+[t,e,n].map(i=>{let o=i.toString(16);return o.length===1?"0"+o:o}).join("")}rgbToCmyk(t,e,n){let i=1-t/255,o=1-e/255,s=1-n/255,m=Math.min(i,o,s);return m===1?{c:0,m:0,y:0,k:100}:(i=Math.round((i-m)/(1-m)*100),o=Math.round((o-m)/(1-m)*100),s=Math.round((s-m)/(1-m)*100),{c:i,m:o,y:s,k:Math.round(m*100)})}rgbToRyb(t,e,n){let i=t/255,o=e/255,s=n/255,m=Math.min(i,o,s),w=i-m,x=o-m,_=s-m,g=Math.min(w,x),ae=w-g,le=x-g,se=_+le,ce=ae,me=g,de=se;return{r:Math.round(ce*255),y:Math.round(me*255),b:Math.round(de*255)}}static \u0275fac=function(e){return new(e||r)(A(L))};static \u0275cmp=H({type:r,selectors:[["app-palette-extractor"]],viewQuery:function(e,n){if(e&1&&(E(pe,5),E(ge,5),E(ue,5),E(fe,5),E(he,5)),e&2){let i;C(i=M())&&(n.videoElement=i.first),C(i=M())&&(n.canvasElement=i.first),C(i=M())&&(n.imageElement=i.first),C(i=M())&&(n.controlsPanel=i.first),C(i=M())&&(n.toggleButton=i.first)}},hostBindings:function(e,n){e&1&&y("click",function(o){return n.onDocumentClick(o)},!1,F)},decls:16,vars:10,consts:[["toggleButton",""],["canvasElement",""],["controlsPanel",""],["imageElement",""],["videoElement",""],[1,"relative","w-full","h-screen","bg-gray-100","dark:bg-gray-900","text-gray-900","dark:text-white","flex"],[1,"absolute","top-4","left-4","z-20"],[1,"bg-opacity-75","p-2","rounded-full","mb-2",3,"click","ngClass"],["xmlns","http://www.w3.org/2000/svg","class","h-6 w-6","fill","none","viewBox","0 0 24 24","stroke","currentColor",4,"ngIf"],["class","bg-opacity-75 p-4 rounded-lg w-80",3,"ngClass",4,"ngIf"],[1,"flex-1","flex","flex-col","items-center","justify-center","p-4","ml-0","md:ml-80"],[1,"w-full","max-w-4xl","mb-4","bg-gray-200","dark:bg-gray-800","rounded-lg","shadow-lg","overflow-hidden"],["class","flex items-center justify-center h-96",4,"ngIf"],["class","w-full h-auto max-h-[60vh] object-contain",3,"src",4,"ngIf"],["autoplay","","playsinline","","class","w-full h-auto",4,"ngIf"],["class","w-full max-w-4xl bg-gray-200 dark:bg-gray-800 p-4 rounded-lg shadow-lg",4,"ngIf"],[1,"hidden"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-6","w-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 6h16M4 12h16M4 18h16"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"bg-opacity-75","p-4","rounded-lg","w-80",3,"ngClass"],["routerLink","/",1,"flex","items-center","text-lg","font-bold","mb-4","w-full","text-left","p-2","rounded-lg","shadow-md","bg-gray-700","hover:bg-gray-600","text-white"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-6","w-6","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],[1,"mb-4"],[1,"font-bold","mb-2"],[1,"flex","space-x-2"],["for","image-upload",1,"flex-1","bg-blue-500","hover:bg-blue-700","text-white","font-bold","py-2","px-4","rounded","cursor-pointer","inline-block","text-center"],["id","image-upload","type","file","accept","image/*",1,"hidden",3,"change"],[1,"flex-1","bg-green-500","hover:bg-green-700","text-white","font-bold","py-2","px-4","rounded",3,"click"],["class","w-full mt-2 bg-indigo-500 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded",3,"click",4,"ngIf"],[1,"mb-2"],["for","color-model",1,"block","mb-1"],["id","color-model",1,"w-full","rounded","py-1","px-2","bg-gray-700","border","border-gray-600",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["for","palette-detail",1,"block","mb-1"],["id","palette-detail","type","range","min","2","max","12",1,"w-full",3,"ngModelChange","ngModel"],[1,"w-full","bg-purple-600","hover:bg-purple-800","text-white","font-bold","py-2","px-4","rounded","disabled:bg-gray-500","disabled:cursor-not-allowed",3,"click","disabled"],[1,"w-full","mt-2","bg-indigo-500","hover:bg-indigo-700","text-white","font-bold","py-2","px-4","rounded",3,"click"],[3,"value"],[1,"flex","items-center","justify-center","h-96"],[1,"text-gray-500"],[1,"w-full","h-auto","max-h-[60vh]","object-contain",3,"src"],["autoplay","","playsinline","",1,"w-full","h-auto"],[1,"w-full","max-w-4xl","bg-gray-200","dark:bg-gray-800","p-4","rounded-lg","shadow-lg"],[1,"text-xl","font-bold","mb-4"],[1,"grid","grid-cols-2","sm:grid-cols-3","md:grid-cols-4","lg:grid-cols-6","gap-4"],["class","flex flex-col items-center",4,"ngFor","ngForOf"],[1,"flex","flex-col","items-center"],[1,"w-20","h-20","rounded-md","mb-2","shadow-md"],[1,"font-mono","text-sm"],[1,"text-xs","font-bold"]],template:function(e,n){if(e&1){let i=S();l(0,"div",5)(1,"div",6)(2,"button",7,0),y("click",function(){return f(i),h(n.controlsCollapsed=!n.controlsCollapsed)}),b(4,be,2,0,"svg",8)(5,ve,2,0,"svg",8),a(),b(6,ye,31,9,"div",9),a(),l(7,"div",10)(8,"div",11),b(9,we,3,0,"div",12)(10,Ee,2,1,"img",13)(11,Ce,2,0,"video",14),a(),b(12,ke,5,1,"div",15)(13,Se,3,0,"div",12),a(),v(14,"canvas",16,1),a()}e&2&&(c(2),d("ngClass",V(9,re)),c(2),d("ngIf",n.controlsCollapsed),c(),d("ngIf",!n.controlsCollapsed),c(),d("ngIf",!n.controlsCollapsed),c(3),d("ngIf",!n.imageSrc&&!n.isWebcamOn),c(),d("ngIf",n.imageSrc),c(),d("ngIf",n.isWebcamOn),c(),d("ngIf",n.palette.length>0),c(),d("ngIf",n.isLoading))},dependencies:[U,N,$,G,q,Y,ie,te,ne,K,Z,ee,J,X],styles:["input[type=range][_ngcontent-%COMP%]{-webkit-appearance:none;appearance:none;background:transparent;cursor:pointer;width:100%}input[type=range][_ngcontent-%COMP%]::-webkit-slider-runnable-track{background:#4a5568;height:.5rem;border-radius:.5rem}input[type=range][_ngcontent-%COMP%]::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;margin-top:-4px;background-color:#a0aec0;height:1.25rem;width:1.25rem;border-radius:50%;border:2px solid #4a5568}input[type=range][_ngcontent-%COMP%]:focus::-webkit-slider-thumb{outline:3px solid #a0aec0;outline-offset:.125rem}input[type=range][_ngcontent-%COMP%]::-moz-range-track{background:#4a5568;height:.5rem;border-radius:.5rem}input[type=range][_ngcontent-%COMP%]::-moz-range-thumb{background-color:#a0aec0;height:1.25rem;width:1.25rem;border-radius:50%;border:2px solid #4a5568}input[type=range][_ngcontent-%COMP%]:focus::-moz-range-thumb{outline:3px solid #a0aec0;outline-offset:.125rem}"]})};export{oe as PaletteExtractorComponent};
